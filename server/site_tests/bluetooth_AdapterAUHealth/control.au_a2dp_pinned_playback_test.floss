# Copyright 2022 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

from autotest_lib.server import utils

AUTHOR = 'Manal Lubbadeh <manal.lubbadeh@exalt.ps>'
NAME = 'bluetooth_AdapterAUHealth.au_a2dp_pinned_playback_test.floss'
PURPOSE = ('Run the A2DP pinned playback test')
CRITERIA = 'Pass all audio chunk checking'
ATTRIBUTES = 'suite:bluetooth_floss'
TIME = 'SHORT'  # Approximately 3 mins
TEST_CATEGORY = 'Functional'
TEST_CLASS = 'bluetooth'
TEST_TYPE = 'server'
DEPENDENCIES = 'bluetooth, working_bluetooth_btpeer:1'
PY_VERSION = 3

DOC = """
    To run the A2DP pinned playback test.

    A2DP profile is used. This test does not choose Bluetooth as the output
    node but directly plays the sound that is pinned to the Bluetooth device
    and check whether it receives the audio stream correctly.
    """

args_dict = utils.args_to_dict(args)

def run(machine):
    host = hosts.create_host(machine)
    job.run_test('bluetooth_AdapterAUHealth', host=host, num_iterations=1,
                 args_dict=args_dict, test_name=NAME.split('.')[1], floss=True)

parallel_simple(run, machines)

# Copyright 2020 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

from autotest_lib.server import utils

AUTHOR = 'chromeos-bluetooth'
NAME = 'bluetooth_AdapterSRHealth.sr_while_advertising'
PURPOSE = (
    "Verify the DUT's discoverable behavior during suspend and after resume"
)
CRITERIA = 'Pass test'
ATTRIBUTES = 'suite:bluetooth, suite:bluetooth_e2e'
TIME = 'SHORT'
TEST_CATEGORY = 'Functional'
TEST_CLASS = 'bluetooth'
TEST_TYPE = 'server'
DEPENDENCIES = 'bluetooth, working_bluetooth_btpeer:1'
PY_VERSION = 3

DOC = """
Verify the DUT's discoverable behavior during suspend and after resume.

Steps:
1. Set the DUT to discoverable and use a peer device to verify.
2. Suspend the DUT.
3. Expect the peer device cannot discover the suspended DUT.
4. Resume the DUT.
5. Expect the peer device can discover the DUT.
6. Set the DUT to undiscoverable and use the peer device to verify.
"""

args_dict = utils.args_to_dict(args)

def run(machine):
    host = hosts.create_host(machine)
    job.run_test('bluetooth_AdapterSRHealth', host=host, num_iterations=1,
                 args_dict=args_dict, test_name=NAME.split('.')[1])

parallel_simple(run, machines)
